<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign In ‚Ä¢ SalFa</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* ===== Theme vars ===== */
    :root{
      --accent: #ffd700;
      --accent-2: #ffdf4f;
      --glass: rgba(255,255,255,0.06);
      --glass-2: rgba(255,255,255,0.04);
      --muted-light: rgba(11,18,32,0.6);
      --muted-dark: rgba(238,246,255,0.65);
      --card-radius: 18px;
    }
    html[data-theme="dark"]{
      --page-bg: linear-gradient(135deg,#071428 0%, #0b2740 60%);
      --card-bg: rgba(255,255,255,0.03);
      --text: #eef6ff;
      --muted: var(--muted-dark);
      --glass-border: rgba(255,255,255,0.06);
    }
    html[data-theme="light"]{
      --page-bg: linear-gradient(135deg,#f7fbff 0%, #e6f0fa 60%);
      --card-bg: rgba(255,255,255,0.85);
      --text: #081126;
      --muted: var(--muted-light);
      --glass-border: rgba(0,0,0,0.06);
    }

    *{ box-sizing:border-box; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    html,body{ height:100%; margin:0; color:var(--text); background:var(--page-bg); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

    /* ===== Layout ===== */
    .wrap{ min-height:100vh; display:grid; place-items:center; padding:28px; }
    .card{
      width:100%; max-width:1000px;
      display:grid; grid-template-columns: 1fr 420px; gap:28px;
      padding:28px; border-radius:var(--card-radius);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--glass-border);
      backdrop-filter: blur(10px) saturate(120%); box-shadow: 0 12px 40px rgba(2,6,23,0.4);
    }

    /* left - branding + motivate */
    .left {
      display:flex; flex-direction:column; gap:18px; justify-content:center; padding:10px 6px;
    }
    .salfa-top{
      display:flex; align-items:center; gap:14px;
    }
    .salfa-mark{
      width:84px; height:84px; border-radius:16px; display:grid; place-items:center;
      font-weight:900; color:white; font-size:28px;
      background: linear-gradient(135deg,#00b4d8,#0077b6);
      box-shadow: 0 8px 22px rgba(3,10,30,0.45);
    }
    .salfa-title{
      font-size:20px; font-weight:800; letter-spacing:0.02em;
    }
    .sectors{ font-size:13px; color:var(--muted); margin-top:4px; }

    .intro { font-size:16px; color:var(--muted); line-height:1.5; }

    .motivation {
      margin-top:8px; min-height:86px; display:flex; align-items:center; justify-content:center;
      border-radius:12px; padding:16px; position:relative;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.02); overflow:hidden;
    }
    .quote {
      font-size:18px; font-weight:700; text-align:center; opacity:0; transform:translateY(10px);
      transition: all 520ms cubic-bezier(.2,.9,.25,1);
      padding:0 10px; color:var(--text);
    }
    .quote.show { opacity:1; transform:translateY(0); }

    /* right - sign-in panel */
    .panel {
      padding:22px; border-radius:12px; display:flex; flex-direction:column; gap:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
    }
    .panel h3{ margin:0; font-size:20px; text-align:center; font-weight:800; color:var(--text); }
    .panel p.sub{ margin:0; text-align:center; color:var(--muted); font-size:14px; }

    .prefs{ display:flex; gap:10px; justify-content:center; margin-top:8px; }
    .prefs button {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.04);
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 18px;
      cursor: pointer;
      color: var(--text);
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .prefs button:hover, .prefs button:focus {
      background-color: var(--glass);
      outline: none;
    }

    .google-btn{
      display:flex; gap:12px; align-items:center; justify-content:center;
      padding:12px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:800;
      background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      color:var(--text); transition: transform .12s ease, box-shadow .12s;
    }
    .google-btn:active{ transform:translateY(1px); }
    .gicon{ width:22px; height:22px; display:block; border-radius:50%; background:#fff; padding:2px; }

    .status { text-align:center; color:var(--muted); font-size:13px; min-height:20px; }

    /* overlay loader */
    .overlay { position:fixed; inset:0; display:grid; place-items:center; background: rgba(2,6,23,0.55); z-index:9999; visibility:hidden; opacity:0; transition: opacity .18s ease; }
    .overlay.show{ visibility:visible; opacity:1; }
    .loader {
      width:72px; height:72px; border-radius:50%; border:8px solid rgba(255,255,255,0.08); border-top-color:var(--accent);
      animation: spin 900ms linear infinite; box-shadow: 0 10px 30px rgba(0,0,0,0.45);
    }
    @keyframes spin{ to{ transform:rotate(360deg); } }

    .foot { text-align:center; color:var(--muted); font-size:13px; margin-top:8px; }

    /* responsiveness */
    @media (max-width:920px){
      .card{ grid-template-columns: 1fr; max-width:720px; padding:20px; gap:18px; }
      .salfa-mark{ width:64px; height:64px; font-size:20px; }
    }
    @media (max-width:480px){
      .card{ padding:14px; gap:12px; }
      .salfa-mark{ width:56px; height:56px; font-size:18px; }
      .quote{ font-size:16px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <main class="card" role="main" aria-labelledby="signinTitle">
      <!-- LEFT -->
      <section class="left" aria-hidden="false">
        <div class="salfa-top">
          <div class="salfa-mark" aria-hidden="true">SF</div>
          <div>
            <div class="salfa-title">SalFa</div>
            
          </div>
        </div>

        <p class="intro" id="introText"></i>Welcome to SalFa ‚Äî your super app for learning, health tips, farm guidance and business tools. Sign in with Google to continue where you left off.</p>

        <div class="motivation" aria-live="polite">
          <div id="quote" class="quote">Preparing inspiration‚Ä¶</div>
        </div>

        <div class="foot" id="footText">We keep your language & theme preferences. Your data is secured by Google Authentication.</div>
      </section>

      <!-- RIGHT -->
      <aside class="panel" aria-labelledby="signinTitle">
        <h3 id="signinTitle">Sign in with Google</h3>
        <p class="sub" id="subText">No passwords ‚Äî secure single-click sign-in.</p>

        <div class="prefs" role="group" aria-label="Preferences">
          <button id="langToggle" title="Change Language" aria-label="Change Language" aria-live="polite">üá¨üáß</button>
          <button id="modeToggle" title="Change Theme Mode" aria-label="Change Theme Mode">üåç</button>
        </div>

        <button id="googleBtn" class="google-btn" aria-label="Continue with Google">
          <img class="gicon" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G" />
          <span id="googleBtnText">Continue with Google</span>
        </button>

        <div id="status" class="status" aria-live="polite"></div>
      </aside>
    </main>
  </div>

  <!-- overlay loader -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="loader" role="status" aria-label="Loading"></div>
  </div>

  <!-- Firebase + App logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    // Firebase config (replace with your actual config)
    const firebaseConfig = {
      apiKey: "AIzaSyB4Mb1RIWqUnD63Q1NdbE9Nkv8QA6LBxHc",
      authDomain: "salfa-d9e37.firebaseapp.com",
      projectId: "salfa-d9e37",
      storageBucket: "salfa-d9e37.firebasestorage.app",
      messagingSenderId: "450649652235",
      appId: "1:450649652235:web:6e3b8db8f2403833721b0e",
      measurementId: "G-WWVNWNEG54"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // UI references
    const overlay = document.getElementById('overlay');
    const googleBtn = document.getElementById('googleBtn');
    const status = document.getElementById('status');
    const quoteEl = document.getElementById('quote');
    const langToggle = document.getElementById('langToggle');
    const modeToggle = document.getElementById('modeToggle');

    // Other text elements for translation
    const signinTitle = document.getElementById('signinTitle');
    const subText = document.getElementById('subText');
    const googleBtnText = document.getElementById('googleBtnText');
    const introText = document.getElementById('introText');
    const footText = document.getElementById('footText');

    // Languages & flags
    const languages = [
      { code: 'en', label: 'English', flag: 'üá¨üáß' },
      { code: 'sw', label: 'Kiswahili', flag: 'üá∞üá™' },
      { code: 'fr', label: 'Fran√ßais', flag: 'üá´üá∑' }
    ];

    // Modes and their icons
    const modes = ['light', 'dark', 'system'];
    const modeIcons = {
      light: '‚òÄÔ∏è',
      dark: 'üåô',
      system: 'üåç'
    };

    // Translations for UI text
    const translations = {
      signinTitle: {
        en: 'Sign in with Google',
        sw: 'Ingia kwa Google',
        fr: 'Connectez-vous avec Google'
      },
      signinSub: {
        en: 'No passwords ‚Äî secure single-click sign-in.',
        sw: 'Hakuna nywila ‚Äî ingia kwa bonyeza moja salama.',
        fr: 'Pas de mot de passe ‚Äî connexion s√©curis√©e en un clic.'
      },
      continueBtn: {
        en: 'Continue with Google',
        sw: 'Endelea na Google',
        fr: 'Continuer avec Google'
      },
      intro: {
        en: 'Welcome to SalFa ‚Äî your super app for learning, health tips, farm guidance and business tools. Sign in with Google to continue where you left off.',
        sw: 'Karibu SalFa ‚Äî app yako bora ya kujifunza, afya, kilimo na biashara. Ingia kwa Google kuendelea kutoka ulipoacha.',
        fr: 'Bienvenue sur SalFa ‚Äî votre super application pour apprendre, conseils sant√©, agriculture et outils commerciaux. Connectez-vous avec Google pour continuer l√† o√π vous vous √™tes arr√™t√©.'
      },
      foot: {
        en: 'We keep your language & theme preferences. Your data is secured by Google Authentication.',
        sw: 'Tunahifadhi lugha na mipangilio ya mandhari yako. Data yako inalindwa na Uthibitishaji wa Google.',
        fr: 'Nous conservons vos pr√©f√©rences de langue et de th√®me. Vos donn√©es sont s√©curis√©es par l\'authentification Google.'
      }
    };

    // Quotes in multiple languages
    const quotes = [
      { en: "Small steps every day lead to big progress.", sw: "Hatua ndogo kila siku zinaongoza kwa maendeleo makubwa.", fr: "Les petits pas quotidiens m√®nent √† de grands progr√®s." },
      { en: "Practice beats talent when talent doesn't practice.", sw: "Mazoezi yanashinda kipaji wakati kipaji hakizoei.", fr: "La pratique bat le talent quand le talent ne pratique pas." },
      { en: "Mistakes are proof you're trying ‚Äî keep going.", sw: "Makosa ni ushahidi wa jaribio ‚Äî endelea mbele.", fr: "Les erreurs prouvent que vous essayez ‚Äî continuez." },
      { en: "Learn today, lead tomorrow.", sw: "Jifunze leo, ongoza kesho.", fr: "Apprenez aujourd'hui, menez demain." },
      { en: "Focus on progress, not perfection.", sw: "Lenga maendeleo, si ukamilifu.", fr: "Concentrez-vous sur le progr√®s, pas la perfection." }
    ];

    let quoteIndex = 0;

    function rotateQuote() {
      const langCode = localStorage.getItem('preferredLanguage') || 'en';
      const q = quotes[quoteIndex % quotes.length][langCode] || quotes[quoteIndex % quotes.length].en;
      quoteEl.classList.remove('show');
      setTimeout(() => {
        quoteEl.textContent = q;
        quoteEl.classList.add('show');
      }, 120);
      quoteIndex++;
    }

    // Initialize preferences
    let currentLangIndex = languages.findIndex(l => l.code === (localStorage.getItem('preferredLanguage') || 'en'));
    if (currentLangIndex === -1) currentLangIndex = 0;

    let currentModeIndex = modes.indexOf(localStorage.getItem('themeMode') || 'system');
    if (currentModeIndex === -1) currentModeIndex = 2; // system by default

    function updateLanguage(langCode) {
      localStorage.setItem('preferredLanguage', langCode);
      // Update UI text
      signinTitle.textContent = translations.signinTitle[langCode];
      subText.textContent = translations.signinSub[langCode];
      googleBtnText.textContent = translations.continueBtn[langCode];
      introText.textContent = translations.intro[langCode];
      footText.textContent = translations.foot[langCode];

      // Update flag icon on button
      const langObj = languages.find(l => l.code === langCode);
      langToggle.textContent = langObj.flag;

      // Update quote
      rotateQuote();
    }

    function updateMode(mode) {
      localStorage.setItem('themeMode', mode);
      if (mode === 'system') {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
      } else {
        document.documentElement.setAttribute('data-theme', mode);
      }
      modeToggle.textContent = modeIcons[mode];
    }

    // Button click handlers to cycle languages and modes
    langToggle.addEventListener('click', () => {
      currentLangIndex = (currentLangIndex + 1) % languages.length;
      updateLanguage(languages[currentLangIndex].code);
    });

    modeToggle.addEventListener('click', () => {
      currentModeIndex = (currentModeIndex + 1) % modes.length;
      updateMode(modes[currentModeIndex]);
    });

    // Initial setup
    updateLanguage(languages[currentLangIndex].code);
    updateMode(modes[currentModeIndex]);
    rotateQuote();
    setInterval(rotateQuote, 5000);

    // Firebase sign-in logic
    function showOverlay(val) {
      overlay.classList.toggle('show', !!val);
      overlay.setAttribute('aria-hidden', !val);
    }

    function setStatus(msg, tone = '') {
      status.textContent = msg;
      status.style.color = tone === 'ok' ? 'var(--accent-2)' : '';
    }

    googleBtn.addEventListener('click', async () => {
      try {
        showOverlay(true);
        setStatus('Signing in‚Ä¶');
        googleBtn.disabled = true;

        const res = await signInWithPopup(auth, provider);

        // Save preferences explicitly after sign-in
        localStorage.setItem('preferredLanguage', languages[currentLangIndex].code);
        localStorage.setItem('themeMode', modes[currentModeIndex]);

        setStatus('Signed in. Redirecting‚Ä¶', 'ok');
        setTimeout(() => {
          window.location.href = 'Home.html';
        }, 700);

      } catch (err) {
        console.error('Sign-in error', err);
        setStatus(err && err.message ? err.message : 'Sign-in failed');
        showOverlay(false);
        googleBtn.disabled = false;
      }
    });

    // Accessibility: trigger click on Enter key
    googleBtn.addEventListener('keyup', (e) => { if (e.key === 'Enter') googleBtn.click(); });
  </script>
</body>
</html>
